FROM  ubuntu/nginx:latest

USER 0

ENV TZ=UTC
ENV DEBIAN_FRONTEND=noninteractive
ENV OPS_USER=1001060000

RUN apt-get update     -yqq         &&  \
    apt-get upgrade    -yqq         &&  \
    apt-get install    -y               \
                       wget             \
                       unzip            \
                       vim              \
                       htop             \
                       php              \
                       php-cli          \
                       php-common       \
                       php-gd           \
                       php-fpm          \
            	       php-imap         \
                       php-mbstring     \
                       php-pdo          \
                       php-mysqlnd      \
                       php-json         \
                       php-opcache      \
                       php-soap         \
                       php-xml          \
		       php-zip       && \
    apt-get -y clean all             && \
    mkdir /projrun                   && \
    mkdir /projtemp                  && \
    mkdir /pvol_files                && \
    chown -R ${OPS_USER}:${OPS_USER} /projrun       && \   
    chown -R ${OPS_USER}:${OPS_USER} /projtemp      && \
    chown -R ${OPS_USER}:${OPS_USER} /pvol_files    && \
    chown -R ${OPS_USER}:${OPS_USER} /run           && \
    chown -R ${OPS_USER}:${OPS_USER} /etc           && \
    chown -R ${OPS_USER}:${OPS_USER} /run           && \
    chown -R ${OPS_USER}:${OPS_USER} /var           && \
    chown -R ${OPS_USER}:${OPS_USER} /usr           


COPY files/* /projrun/

RUN chmod -R a+x /projrun/run_nginx.sh && \
    chown -R ${OPS_USER}:${OPS_USER} /projrun
    
USER ${OPS_USER}

WORKDIR /projtemp

RUN wget -q https://jztkft.dl.sourceforge.net/project/projectorria/projeqtorV9.3.5.zip && \
    unzip -q *.zip && rm *.zip 
    
COPY /projrun/config/nginx.conf  /etc/nginx/nginx.conf
COPY /projrun/config/php.ini     /etc/php/8.0/fpm/php.ini
COPY /projrun/config/www.conf    /etc/php/8.0/fpm/pool.d/www.conf
COPY /projrun/config/default     /etc/nginx/sites-enabled/default
COPY /projrun/config/parameters.php   /pvol_files/files/config/parameters.php
COPY /projrun/config/parametersLocation.php  /var/www/html/projeqtor/tool/parametersLocation.php





CMD /projrun/run_nginx.sh
